<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lfm.wms.dao.SysRoleMapper">
    <resultMap id="BaseResultMap" type="com.lfm.wms.model.SysRole">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="role_name" jdbcType="VARCHAR" property="roleName"/>
        <result column="role_desc" jdbcType="VARCHAR" property="roleDesc"/>
        <result column="role_value" jdbcType="VARCHAR" property="roleValue"/>
       <!-- <result column="create_time" jdbcType="VARCHAR" property="createTime"/>
        <result column="update_time" jdbcType="VARCHAR" property="updateTime"/>-->
        <result column="is_disable" jdbcType="VARCHAR" property="isDisable"/>
    </resultMap>
    <resultMap id="BaseResultMap1" type="com.lfm.wms.model.UserInfo">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="user_name" jdbcType="VARCHAR" property="userName"/>
        <result column="password" jdbcType="VARCHAR" property="password"/>
        <result column="salt" jdbcType="VARCHAR" property="salt"/>
    </resultMap>

    <sql id="Base_Column_List">
      id,role_name,role_desc,role_value,create_time,update_time,is_disable
    </sql>
    <select id="selectAllRole" resultMap="BaseResultMap"  parameterType="com.lfm.wms.model.SysRole">
        <!--
           WARNING - @mbggenerated
           This element is automatically generated by MyBatis Generator, do not modify.
         -->
        select *
        from sys_role
        where 1=1
        <if test="roleValue !=null and roleValue !=''">
            and role_value like concat('%',#{roleValue},'%')
        </if>
    </select>
    <insert id="addRole" parameterType="com.lfm.wms.model.SysRole">
        <selectKey keyProperty="id" resultType="Integer" order="BEFORE">
          select if(max(id) is null,1,max(id)+1) as newId from sys_role
        </selectKey>
    insert into sys_role (role_name,role_desc,role_value,create_time,is_disable
      )
    values (#{roleName},#{roleDesc}, #{roleValue}, #{createTime},
        #{isDisable}
      )
      <!--  <selectKey resultType="int" keyProperty="id" order="AFTER">
            select max(id)+1 as newId from sys_role
        </selectKey>-->

  </insert>
    <select id="selectByRoleName" parameterType="String" resultMap="BaseResultMap">
      select * from sys_role where role_name=#{role_name}
    </select>
    <delete id="deleteRole" parameterType="Integer">
        delete from sys_role
        where id=#{id}
    </delete>
    <update id="updateRole" parameterType="com.lfm.wms.model.SysRole">
         update sys_role
        set role_name=#{roleName},role_desc=#{roleDesc},
        role_value=#{roleValue},is_disable=#{isDisable}
        where id =
        #{id}
    </update>
    <select id="selectRoleUser" parameterType="com.lfm.wms.model.SysRole" resultType="String">
      select user_id from user_role where role_id=#{id}
    </select>
    <select id="selectRoleUser1" resultMap="BaseResultMap1"  parameterType="com.lfm.wms.model.SysRole">
        select ui.id,ui.user_name from user_info ui
        left join  user_role ur
        on ur.user_id = ui.id where ur.role_id=#{id}
    </select>
    <insert id="bindUser">
      insert  into user_role (user_id,role_id) values (#{u_id},#{s_id})
    </insert>
    <insert id="bindUser1" parameterType="java.util.List">
      insert  into user_role (user_id,role_id) values
        <!--item就是List里每一项的对象名，要用","分割每一条数据，最后要";"结尾-->
        <foreach collection="list" item="item" index="index" separator="," close=";">
            (#{item.uid},#{item.sid})
        </foreach>
    </insert>
    <delete id="deleteBindUser">
        delete  from user_role
        where user_id=#{u_id} and role_id=#{s_id}
    </delete>
    <select id="selectNoBindRoleUser" resultMap="BaseResultMap1"  parameterType="com.lfm.wms.model.SysRole">

        select * from user_info where id not in (
      select  distinct
      ui.id from user_info ui
      left join  user_role ur
        on
				 ur.user_id = ui.id

				where ur.role_id =#{id})
    </select>
    <select id="getRoleValue" parameterType="Integer" resultType="String">
        select role_value from sys_role where id =#{id}
    </select>
</mapper>